<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">


  </head>

  <body>

    {% extends 'base.html' %}
    
    {% block header %}
    <h1>{% block title %}selected query{% endblock %}</h1>
    {% endblock %}

    {% block content %}



        <div id="top-section">

          <div id="select-query">
              <section id="show-query">{{ selected_query|safe }}</section>
          </div>

            <div id="show-list">
              <section id="meta-data" hidden>{{ meta_data }}</section>
              <section id="freq-tables" hidden>{{ frequency_table|safe }}</section></div>
            </div>

        <br>

        <div id="table-window">

          <div id="show-query-results">{{ query_table|safe }}</div>

        </div>

    <script>

        const resultsContainer = document.querySelector("#show-query-results");
        const selectedQueryContainer = document.querySelector("#select-query");
        const listContainer = document.querySelector("#show-list");
        const table = document.querySelector("#query-results");

        const tweets = $("#query-results tr");
        delete tweets[0];

        const metadataString = document.querySelector("#meta-data")
        const metadata = JSON.parse(metadataString.innerText);

        const freqTableString = document.querySelector("#meta-data")
        const freqTables = JSON.parse(freqTableString.innerText);

        const mdList = document.createElement("ol");
        listContainer.appendChild(mdList);

        // div with class tooltip around all metadata tables (hide tooltip)
        // div with class tooltip area around all tweets

        let tooltipId = 1;
        for(let tbl in metadata){
            let tooltip = document.createElement("div")
            tooltip.classList.add("tooltip");
            tooltip.id = tooltipId;
            tooltip.innerHTML = metadata[tbl];
            //tooltip.style.display = "none";
            document.body.appendChild(tooltip);
            tooltipId += 1;
        }

        //document.querySelectorAll(".md-tbl").style.display = "none";

        try{
            let tweetId = 1;

            for(let row in tweets){

              let tooltipContainer = document.createElement("div");
              tooltipContainer.classList.add("tooltip-area");
              let innerHtml = tweets[row].children[2].innerHTML;
              tweets[row].children[2].innerHTML = "";
              tweets[row].children[2].appendChild(tooltipContainer);
              tooltipContainer.innerHTML = innerHtml;
              tooltipContainer.id = tweetId;
              tweetId += 1;
            }

        }catch{

        }

        /*for(let tbl in metadata){

        }*/

        // display tooltip on hover for every tweet
        $(function() {

            // mouse hover
            $(".tooltip-area").hover(function() {

                let offset = $(".tooltip-area").offset();

                $(".tooltip").css({
                    top: offset.top - 130,
                    left: offset.left - 62,
                    display: "block"
                })

                $(".tooltip").animate({ opacity: 1.0 }, 0);
            // move away mouse
            },  function(){
                $(".tooltip").animate({ opacity: 0.0 }, 200);
                $(".tooltip").css({ display: "none" });
            })

        });

        /*for(let tbl in metadata){
        let li = document.createElement("li");
        mdList.appendChild(li)
        //let link = document.createElement("a");
        //li.innerHTML = link;
        //li.innerHTML = "<span class='md-tbl'>"+metadata[tbl]+"</span>";
        }*/

    </script>

    {% endblock %}

    <script src="{{ url_for('static', filename='queryscript.js') }}" type="text/javascript"></script>

  </body>
</html>

